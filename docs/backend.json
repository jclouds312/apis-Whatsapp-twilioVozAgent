
{
  "entities": {
    "ApiKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiKey",
      "type": "object",
      "description": "Represents an API Key used for authenticating with external services.",
      "properties": {
        "service": {
          "type": "string",
          "description": "The name of the service this key is for (e.g., 'WhatsApp Business', 'Twilio')."
        },
        "description": {
          "type": "string",
          "description": "A user-provided description for the API key's purpose."
        },
        "key": {
          "type": "string",
          "description": "The actual API key value (should be encrypted at rest)."
        },
        "status": {
          "type": "string",
          "description": "The status of the API key.",
          "enum": ["active", "revoked"]
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the API key was created.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this key."
        }
      },
      "required": [
        "service",
        "key",
        "status",
        "createdAt",
        "userId",
        "description"
      ]
    },
    "ExposedApi": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExposedApi",
      "type": "object",
      "description": "Represents an API endpoint exposed by this platform for consumption by external systems.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The human-readable name of the exposed API."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of what the API does."
        },
        "endpoint": {
          "type": "string",
          "description": "The relative path of the API endpoint (e.g., /api/v1/send-message)."
        },
        "method": {
          "type": "string",
          "description": "The HTTP method for the endpoint.",
          "enum": ["GET", "POST", "PUT", "DELETE"]
        },
        "status": {
          "type": "string",
          "description": "The current status of the API.",
          "enum": ["published", "draft", "deprecated"]
        },
        "version": {
          "type": "string",
          "description": "The version string for the API (e.g., '1.0.0')."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this exposed API."
        }
      },
      "required": [
        "name",
        "description",
        "endpoint",
        "method",
        "status",
        "version",
        "userId"
      ]
    },
    "ApiLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiLog",
      "type": "object",
      "description": "Stores logs of API requests and responses.",
      "properties": {
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the API request.",
          "format": "date-time"
        },
        "endpoint": {
          "type": "string",
          "description": "Endpoint that was accessed."
        },
        "requestBody": {
          "type": "string",
          "description": "Request body (JSON string)."
        },
        "responseBody": {
          "type": "string",
          "description": "Response body (JSON string)."
        },
        "statusCode": {
          "type": "number",
          "description": "HTTP status code of the response."
        },
        "apiKeyId": {
          "type": "string",
          "description": "Reference to ApiKey. (Relationship: ApiKey 1:N ApiLog)"
        },
        "level": {
          "type": "string",
          "enum": ["info", "warn", "error"]
        }
      },
      "required": [
        "timestamp",
        "endpoint",
        "requestBody",
        "responseBody",
        "statusCode",
        "apiKeyId",
        "level"
      ]
    },
    "DashboardUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DashboardUser",
      "type": "object",
      "description": "Represents a user who has access to the admin dashboard.",
      "properties": {
        "name": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "role": { "type": "string", "enum": ["Admin", "Manager", "Developer", "Agent"] },
        "avatarUrl": { "type": "string", "format": "uri" }
      },
      "required": ["name", "email", "role"]
    },
    "Workflow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Workflow",
      "type": "object",
      "description": "Defines a workflow within Function Connect.",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "trigger": {
            "type": "object",
            "properties": {
                "service": { "type": "string", "enum": ["WhatsApp", "Twilio", "CRM"]},
                "event": { "type": "string" }
            }
        },
        "steps": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": { "type": "string" },
                    "description": { "type": "string" }
                }
            }
        },
        "status": { "type": "string", "enum": ["active", "inactive"] },
        "lastRun": { "type": "string", "format": "date-time" },
        "userId": { "type": "string" }
      },
      "required": [
        "name",
        "description",
        "steps",
        "userId",
        "trigger",
        "status"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        }
      },
      "required": ["id"]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a chat conversation with a contact.",
      "properties": {
          "contactName": { "type": "string" },
          "contactEmail": { "type": "string", "format": "email" },
          "contactAvatar": { "type": "string", "format": "uri" },
          "contactId": { "type": "string", "description": "Phone number for WhatsApp or other identifier" },
          "tags": { "type": "array", "items": { "type": "string" } },
          "agentNotes": { "type": "string" },
          "orderHistory": {
              "type": "array",
              "items": {
                  "type": "object",
                  "properties": {
                      "id": { "type": "string" },
                      "date": { "type": "string", "format": "date-time" },
                      "total": { "type": "number" },
                      "status": { "type": "string", "enum": ["Completed", "Pending", "Cancelled"] }
                  },
                  "required": ["id", "date", "total", "status"]
              }
          },
          "lastMessage": { "type": "string" },
          "lastMessageTime": { "type": "string", "format": "date-time" },
          "userId": { "type": "string" }
      },
      "required": ["contactName", "contactId", "lastMessage", "lastMessageTime", "userId"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a conversation.",
      "properties": {
          "contactId": { "type": "string" },
          "content": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "isSender": { "type": "boolean" }
      },
      "required": ["contactId", "content", "timestamp", "isSender"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": { "$ref": "#/entities/User" },
      "description": "Collection to store user profiles."
    },
    "/users/{userId}/apiKeys/{apiKeyId}": {
      "schema": { "$ref": "#/entities/ApiKey" },
      "description": "Stores API keys for integrated third-party services like WhatsApp, Twilio, etc."
    },
    "/users/{userId}/exposedApis/{exposedApiId}": {
      "schema": { "$ref": "#/entities/ExposedApi" },
      "description": "Stores API endpoints exposed by this platform for consumption by external systems."
    },
    "/users/{userId}/workflows/{workflowId}": {
      "schema": { "$ref": "#/entities/Workflow" },
      "description": "Collection to store workflows for each user. Secured by path-based ownership."
    },
    "/users/{userId}/conversations/{conversationId}": {
        "schema": { "$ref": "#/entities/Conversation" },
        "description": "Stores all chat conversations for a user."
    },
    "/users/{userId}/conversations/{conversationId}/messages/{messageId}": {
        "schema": { "$ref": "#/entities/Message" },
        "description": "Stores all messages within a specific conversation."
    },
    "/apiLogs/{apiLogId}": {
      "schema": { "$ref": "#/entities/ApiLog" },
      "description": "Collection to store API logs. Consider partitioning by date for scalability."
    },
    "/dashboardUsers/{dashboardUserId}": {
      "schema": { "$ref": "#/entities/DashboardUser" },
      "description": "Collection to store dashboard users. Access controlled by roles."
    }
  }
}

    