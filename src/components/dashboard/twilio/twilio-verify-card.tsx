\'use client\';\n\nimport { useState } from \'react\';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { Loader2 } from \'lucide-react\';\n\nasync function fetchFromTwilioProxy(endpoint: string, apiKey: string, body: any) {\n    const url = `/api/twilio/${endpoint}`.replace(/\.json$/, \'\'); // Clean .json if it exists\n    const response = await fetch(url, {\n        method: \'POST\',\n        headers: {\n            \'Authorization\': `Bearer ${apiKey}`,\n            \'Content-Type\': \'application/x-www-form-urlencoded\',\n        },\n        body: new URLSearchParams(body).toString(),\n    });\n    if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \'An API error occurred\');\n    }\n    return response.json();\n}\n\nexport function TwilioVerifyCard() {\n    const [apiKey, setApiKey] = useState(\'\');\n    const [phoneNumber, setPhoneNumber] = useState(\'\');\n    const [verificationCode, setVerificationCode] = useState(\'\');\n    const [verificationSid, setVerificationSid] = useState(\'\');\n    const [isLoading, setIsLoading] = useState(false);\n    const [isChecking, setIsChecking] = useState(false);\n    const { toast } = useToast();\n\n    const handleSendVerification = async () => {\n        if (!apiKey || !phoneNumber) {\n            toast({ title: \"Missing Fields\", description: \"API Key and Phone Number are required.\", variant: \"destructive\" });\n            return;\n        }\n        setIsLoading(true);\n        try {\n            const data = await fetchFromTwilioProxy(\'Verifications\', apiKey, {\n                To: phoneNumber,\n                Channel: \'sms\',\n            });\n            setVerificationSid(data.sid);\n            toast({ title: \"Verification Sent\", description: `A code has been sent to ${phoneNumber}.` });\n        } catch (error: any) {\n            toast({ title: \"Error Sending Verification\", description: error.message, variant: \"destructive\" });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleCheckVerification = async () => {\n        if (!verificationSid || !verificationCode) {\n            toast({ title: \"Missing Fields\", description: \"Please send a verification first and enter the code.\", variant: \"destructive\" });\n            return;\n        }\n        setIsChecking(true);\n        try {\n            const data = await fetchFromTwilioProxy(\`VerificationCheck\`, apiKey, {\n                VerificationSid: verificationSid,\n                Code: verificationCode,\n            });\n            if (data.status === \'approved\') {\n                toast({ title: \"Verification Successful!\", description: \"The phone number has been successfully verified.\", className: \'bg-green-100 text-green-800\' });\n            } else {\n                toast({ title: \"Verification Failed\", description: data.message || \"The code is incorrect.\", variant: \"destructive\" });\n            }\n        } catch (error: any) {\n            toast({ title: \"Error Checking Verification\", description: error.message, variant: \"destructive\" });\n        } finally {\n            setIsChecking(false);\n        }\n    };\n\n\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle>Twilio Verify</CardTitle>\n                <CardDescription>Send and check SMS verification codes via your secure Twilio proxy.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                 <div className=\"space-y-2\">\n                    <Label htmlFor=\"apiKey\'>Twilio API Key</Label>\n                    <Input id=\"apiKey\" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder=\"Enter your Twilio-specific API Key\" />\n                </div>\n                <div className=\"flex items-end gap-2\">\n                    <div className=\"flex-1\">\n                        <Label htmlFor=\"phoneNumber\">Phone Number</Label>\n                        <Input id=\"phoneNumber\" value={phoneNumber} onChange={e => setPhoneNumber(e.target.value)} placeholder=\"+1234567890\" />\n                    </div>\n                    <Button onClick={handleSendVerification} disabled={isLoading}>\n                        {isLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \'Send Code\'}\n                    </Button>\n                </div>\n                {verificationSid && (\n                    <div className=\"flex items-end gap-2\">\n                         <div className=\"flex-1\">\n                            <Label htmlFor=\"verificationCode\">Verification Code</Label>\n                            <Input id=\"verificationCode\" value={verificationCode} onChange={e => setVerificationCode(e.target.value)} placeholder=\"Enter 6-digit code\" />\n                        </div>\n                        <Button onClick={handleCheckVerification} disabled={isChecking}>\n                            {isChecking ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \'Verify Code\'}\n                        </Button>\n                    </div>\n                )}
            </CardContent>\n        </Card>\n    );\n}
